{"ast":null,"code":"import _toConsumableArray from\"C:/Users/hiksvalP/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/hiksvalP/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import{Header}from'./Header.js';import{Main}from'./Main.js';import{Footer}from'./Footer.js';import{ImagePopup}from'./ImagePopup.js';import{api}from\"../utils/Api.js\";import{CurrentUserContext}from'../contexts/CurrentUserContext.js';import{EditProfilePopup}from'./EditProfilePopup.js';import{EditAvatarPopup}from'./EditAvatarPopup.js';import{AddPlacePopup}from'./AddPlacePopup.js';import{Card}from\"./Card.js\";import{Login}from\"./Login.js\";import{Register}from\"./Register.js\";import{InfoToolTip}from\"./InfoToolTip\";import{Routes,Route,useNavigate}from\"react-router-dom\";import{ProtectedRoute}from\"./ProtectedRoute.js\";import{authApi}from'../utils/authApi.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var navigate=useNavigate();// стейт перменные попапов\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditAvatarPopupOpen=_useState4[0],setEditAvatarPopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setAddPlacePopupOpen=_useState6[1];var _useState7=useState({opened:false,status:false}),_useState8=_slicedToArray(_useState7,2),isInfoToolTipOpen=_useState8[0],setInfoToolTipOpen=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),selectedCard=_useState10[0],setSelectedCard=_useState10[1];// стейт карточек\nvar _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cards=_useState12[0],setCards=_useState12[1];// стейт логина\nvar _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loggedIn=_useState14[0],setLoggedIn=_useState14[1];// стейт почты пользователя\nvar _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),email=_useState16[0],setEmail=_useState16[1];// стейт с данными пользователя \nvar _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),currentUser=_useState18[0],setCurrentUser=_useState18[1];// функция создания куки\nvar createCookieInHour=function createCookieInHour(cookieName,cookieValue,hourToExpire){var date=new Date();date.setTime(date.getTime()+hourToExpire*60*60*1000);document.cookie=cookieName+\" = \"+cookieValue+\"; expires = \"+date.toGMTString();};// проверка на наличие токена в хранилище браузера\nuseEffect(function(){var token=localStorage.getItem(\"jwt\");createCookieInHour('jwt',token,168);if(token){authApi.tokenCheck(token).then(function(res){setLoggedIn(true);}).catch(function(err){console.log(authApi.tokenCheck(token));console.log(err);});}},[]);// установка данных текущего пользователя \nuseEffect(function(){if(loggedIn){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});}},[loggedIn]);// обработчики открытия попапов\nvar handleEditAvatarClick=function handleEditAvatarClick(){setEditAvatarPopupOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};var handleCardClick=function handleCardClick(card){setSelectedCard(card);};// хендлеры обновления данных пользователя \nvar handleUpdateUser=function handleUpdateUser(user){api.editInfo(user.name,user.about).then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});closeAllPopups();};var handleUpdateAvatar=function handleUpdateAvatar(input){api.changeAvatar(input.avatar).then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});closeAllPopups();};// хэндлер выхода из профиля\nvar handleLogOut=function handleLogOut(){localStorage.removeItem(\"jwt\");setLoggedIn(false);navigate('/sign-in');};// реализация логина + сохранение токена\nvar signIn=function signIn(input){authApi.signIn(input.email,input.password).then(function(res){localStorage.setItem(\"jwt\",res.token);setEmail(input.email);setLoggedIn(true);navigate('/');}).catch(function(err){console.log(err);setInfoToolTipOpen({opened:true,status:false});});};// передача данных для рпегистрации\nvar handleRegister=function handleRegister(input){authApi.signUp(input.email,input.password).then(function(res){setInfoToolTipOpen({opened:true,status:true});navigate('/sign-in');}).catch(function(err){setInfoToolTipOpen({opened:true,status:false});});};// закрытие всех попапов\nvar closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setSelectedCard(null);setInfoToolTipOpen({opened:false,status:isInfoToolTipOpen.status});};// загрузка карточек\nuseEffect(function(){if(loggedIn){api.getCards().then(function(res){setCards(res);}).catch(function(err){console.log(err);});}},[loggedIn]);// функция лайка карточки\nfunction handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});});}// функция удаления карточки\nfunction handleCardDelete(card){// проверяем являемся ли мы владельцем карточки\nvar isMine=card.owner===currentUser._id;// отправляем запрос на удаление карточки\napi.deleteCard(card._id,isMine).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});});}// функция добавления карточки\nfunction handleAddPlaceSubmit(newCard){api.uploadCard(newCard.placeName,newCard.placeUrl).then(function(res){setCards([res].concat(_toConsumableArray(cards)));}).catch(function(err){console.log(err);});closeAllPopups();}// обработка массива с карточками\nvar sectionWithCards=function sectionWithCards(){if(cards.length>0){return cards.map(function(cardInfo){return/*#__PURE__*/_jsx(Card,{card:cardInfo,onCardLike:handleCardLike,onCardDelete:handleCardDelete,selectedCard:handleCardClick},cardInfo._id);});}};// вся разметка сайта\nreturn/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"page__size\",children:[/*#__PURE__*/_jsx(Header,{onCLick:handleLogOut,email:email}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsx(Login,{onLogin:signIn})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsx(Register,{login:loggedIn,onRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(ProtectedRoute,{loggedIn:loggedIn,component:/*#__PURE__*/_jsx(Main,{cards:sectionWithCards(),onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick})})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(ImagePopup,{onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipOpen,onClose:closeAllPopups})]})})});}export default App;","map":{"version":3,"sources":["C:/Users/hiksvalP/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useState","useEffect","Header","Main","Footer","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Card","Login","Register","InfoToolTip","Routes","Route","useNavigate","ProtectedRoute","authApi","App","navigate","isEditProfilePopupOpen","setEditProfilePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","opened","status","isInfoToolTipOpen","setInfoToolTipOpen","selectedCard","setSelectedCard","cards","setCards","loggedIn","setLoggedIn","email","setEmail","currentUser","setCurrentUser","createCookieInHour","cookieName","cookieValue","hourToExpire","date","Date","setTime","getTime","document","cookie","toGMTString","token","localStorage","getItem","tokenCheck","then","res","catch","err","console","log","getUserInfo","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleUpdateUser","user","editInfo","name","about","closeAllPopups","handleUpdateAvatar","input","changeAvatar","avatar","handleLogOut","removeItem","signIn","password","setItem","handleRegister","signUp","getCards","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","isMine","owner","deleteCard","filter","handleAddPlaceSubmit","uploadCard","placeName","placeUrl","sectionWithCards","length","cardInfo"],"mappings":"kRAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,KAAyC,OAAzC,CACA,OAAQC,MAAR,KAAqB,aAArB,CACA,OAAQC,IAAR,KAAmB,WAAnB,CACA,OAAQC,MAAR,KAAqB,aAArB,CACA,OAAQC,UAAR,KAAyB,iBAAzB,CACA,OAAQC,GAAR,KAAkB,iBAAlB,CACA,OAASC,kBAAT,KAAmC,mCAAnC,CACA,OAASC,gBAAT,KAAiC,uBAAjC,CACA,OAASC,eAAT,KAAgC,sBAAhC,CACA,OAASC,aAAT,KAA8B,oBAA9B,CACA,OAAQC,IAAR,KAAmB,WAAnB,CACA,OAASC,KAAT,KAAsB,YAAtB,CACA,OAASC,QAAT,KAAyB,eAAzB,CACA,OAASC,WAAT,KAA4B,eAA5B,CACA,OAASC,MAAT,CAAiBC,KAAjB,CAAwBC,WAAxB,KAA2C,kBAA3C,CACA,OAAQC,cAAR,KAA6B,qBAA7B,CACA,OAASC,OAAT,KAAwB,qBAAxB,C,wFAEA,QAASC,CAAAA,GAAT,EAAe,CAEf,GAAMC,CAAAA,QAAQ,CAAGJ,WAAW,EAA5B,CAEA;AAEA,cAA0DjB,QAAQ,CAAC,KAAD,CAAlE,wCAAOsB,sBAAP,eAA+BC,uBAA/B,eACA,eAAwDvB,QAAQ,CAAC,KAAD,CAAhE,yCAAOwB,qBAAP,eAA8BC,sBAA9B,eACA,eAAoDzB,QAAQ,CAAC,KAAD,CAA5D,yCAAO0B,mBAAP,eAA4BC,oBAA5B,eACA,eAAgD3B,QAAQ,CAAC,CAAC4B,MAAM,CAAE,KAAT,CAAgBC,MAAM,CAAE,KAAxB,CAAD,CAAxD,yCAAOC,iBAAP,eAA0BC,kBAA1B,eACA,eAAwC/B,QAAQ,CAAC,IAAD,CAAhD,0CAAOgC,YAAP,gBAAqBC,eAArB,gBAEA;AAEA,gBAA0BjC,QAAQ,CAAC,EAAD,CAAlC,2CAAOkC,KAAP,gBAAcC,QAAd,gBAEA;AAEA,gBAAgCnC,QAAQ,CAAC,KAAD,CAAxC,2CAAOoC,QAAP,gBAAiBC,WAAjB,gBAEA;AACA,gBAA0BrC,QAAQ,CAAC,EAAD,CAAlC,2CAAOsC,KAAP,gBAAcC,QAAd,gBAEA;AAEA,gBAAsCvC,QAAQ,CAAC,EAAD,CAA9C,2CAAOwC,WAAP,gBAAoBC,cAApB,gBAEA;AACA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,UAAD,CAAaC,WAAb,CAA0BC,YAA1B,CAA2C,CACpE,GAAIC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,EAAX,CACAD,IAAI,CAACE,OAAL,CAAaF,IAAI,CAACG,OAAL,GAAgBJ,YAAY,CAAC,EAAb,CAAgB,EAAhB,CAAmB,IAAhD,EACAK,QAAQ,CAACC,MAAT,CAAkBR,UAAU,CAAG,KAAb,CAAqBC,WAArB,CAAmC,cAAnC,CAAmDE,IAAI,CAACM,WAAL,EAArE,CACD,CAJD,CAMA;AACAnD,SAAS,CAAC,UAAM,CACZ,GAAMoD,CAAAA,KAAK,CAAGC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAd,CACAb,kBAAkB,CAAC,KAAD,CAAQW,KAAR,CAAe,GAAf,CAAlB,CACA,GAAGA,KAAH,CAAU,CACRlC,OAAO,CAACqC,UAAR,CAAmBH,KAAnB,EACCI,IADD,CACM,SAACC,GAAD,CAAS,CACbrB,WAAW,CAAC,IAAD,CAAX,CACD,CAHD,EAICsB,KAJD,CAIO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAY3C,OAAO,CAACqC,UAAR,CAAmBH,KAAnB,CAAZ,EACAQ,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAPD,EAQD,CACJ,CAbQ,CAaN,EAbM,CAAT,CAgBA;AACA3D,SAAS,CAAC,UAAM,CACd,GAAGmC,QAAH,CAAa,CACX9B,GAAG,CAACyD,WAAJ,GACCN,IADD,CACM,SAAAC,GAAG,CAAI,CACXjB,cAAc,CAACiB,GAAD,CAAd,CACD,CAHD,EAICC,KAJD,CAIO,SAAAC,GAAG,CAAI,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOD,CACF,CAVQ,CAUP,CAACxB,QAAD,CAVO,CAAT,CAYA;AAEA,GAAM4B,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,EAAM,CAClCvC,sBAAsB,CAAC,IAAD,CAAtB,CACD,CAFD,CAIA,GAAMwC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,EAAM,CACnC1C,uBAAuB,CAAC,IAAD,CAAvB,CACD,CAFD,CAIA,GAAM2C,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,EAAM,CAChCvC,oBAAoB,CAAC,IAAD,CAApB,CACD,CAFD,CAIA,GAAMwC,CAAAA,eAAe,CAAI,QAAnBA,CAAAA,eAAmB,CAACC,IAAD,CAAU,CACjCnC,eAAe,CAACmC,IAAD,CAAf,CACD,CAFD,CAIA;AAEC,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,IAAD,CAAU,CAClChE,GAAG,CAACiE,QAAJ,CAAaD,IAAI,CAACE,IAAlB,CAAwBF,IAAI,CAACG,KAA7B,EACChB,IADD,CACM,SAAAC,GAAG,CAAI,CACXjB,cAAc,CAACiB,GAAD,CAAd,CACD,CAHD,EAICC,KAJD,CAIO,SAAAC,GAAG,CAAI,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOAc,cAAc,GACd,CATD,CAWA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,KAAD,CAAW,CACnCtE,GAAG,CAACuE,YAAJ,CAAiBD,KAAK,CAACE,MAAvB,EACCrB,IADD,CACM,SAAAC,GAAG,CAAI,CACXjB,cAAc,CAACiB,GAAD,CAAd,CACD,CAHD,EAICC,KAJD,CAIO,SAAAC,GAAG,CAAI,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOAc,cAAc,GAChB,CATD,CAWA;AAEA,GAAMK,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CAC1BzB,YAAY,CAAC0B,UAAb,CAAwB,KAAxB,EACA3C,WAAW,CAAC,KAAD,CAAX,CACAhB,QAAQ,CAAC,UAAD,CAAR,CACA,CAJD,CAMA;AACC,GAAM4D,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACL,KAAD,CAAW,CACxBzD,OAAO,CAAC8D,MAAR,CAAeL,KAAK,CAACtC,KAArB,CAA4BsC,KAAK,CAACM,QAAlC,EACCzB,IADD,CACM,SAACC,GAAD,CAAS,CACbJ,YAAY,CAAC6B,OAAb,CAAqB,KAArB,CAA4BzB,GAAG,CAACL,KAAhC,EACAd,QAAQ,CAACqC,KAAK,CAACtC,KAAP,CAAR,CACAD,WAAW,CAAC,IAAD,CAAX,CACAhB,QAAQ,CAAC,GAAD,CAAR,CACD,CAND,EAOCsC,KAPD,CAOO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACA7B,kBAAkB,CAAC,CAACH,MAAM,CAAE,IAAT,CAAeC,MAAM,CAAE,KAAvB,CAAD,CAAlB,CACD,CAVD,EAWD,CAZD,CAcA;AACA,GAAMuD,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACR,KAAD,CAAW,CAChCzD,OAAO,CAACkE,MAAR,CAAeT,KAAK,CAACtC,KAArB,CAA4BsC,KAAK,CAACM,QAAlC,EACCzB,IADD,CACM,SAACC,GAAD,CAAS,CACb3B,kBAAkB,CAAC,CAACH,MAAM,CAAE,IAAT,CAAeC,MAAM,CAAE,IAAvB,CAAD,CAAlB,CACAR,QAAQ,CAAC,UAAD,CAAR,CACD,CAJD,EAKCsC,KALD,CAKO,SAACC,GAAD,CAAS,CACd7B,kBAAkB,CAAC,CAACH,MAAM,CAAE,IAAT,CAAeC,MAAM,CAAE,KAAvB,CAAD,CAAlB,CACD,CAPD,EAQD,CATD,CAWF;AAEA,GAAM6C,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CACzBjD,sBAAsB,CAAC,KAAD,CAAtB,CACAF,uBAAuB,CAAC,KAAD,CAAvB,CACAI,oBAAoB,CAAC,KAAD,CAApB,CACAM,eAAe,CAAC,IAAD,CAAf,CACAF,kBAAkB,CAAC,CAACH,MAAM,CAAE,KAAT,CAAgBC,MAAM,CAAEC,iBAAiB,CAACD,MAA1C,CAAD,CAAlB,CACH,CAND,CAQE;AAEA5B,SAAS,CAAC,UAAM,CACd,GAAGmC,QAAH,CAAa,CACX9B,GAAG,CAACgF,QAAJ,GACC7B,IADD,CACM,SAAAC,GAAG,CAAI,CACXvB,QAAQ,CAACuB,GAAD,CAAR,CACD,CAHD,EAICC,KAJD,CAIO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOD,CACF,CAVQ,CAUN,CAACxB,QAAD,CAVM,CAAT,CAYE;AAEA,QAASmD,CAAAA,cAAT,CAAwBnB,IAAxB,CAA8B,CAC5B;AACA,GAAMoB,CAAAA,OAAO,CAAGpB,IAAI,CAACqB,KAAL,CAAWC,IAAX,CAAgB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAKnD,WAAW,CAACoD,GAAtB,EAAjB,CAAhB,CAEA;AACAtF,GAAG,CAACuF,oBAAJ,CAAyBzB,IAAI,CAACwB,GAA9B,CAAmCJ,OAAnC,EACC/B,IADD,CACM,SAACqC,OAAD,CAAa,CACf3D,QAAQ,CAAC,SAAC4D,KAAD,QAAWA,CAAAA,KAAK,CAACC,GAAN,CAAU,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUxB,IAAI,CAACwB,GAAf,CAAqBE,OAArB,CAA+BG,CAAtC,EAAV,CAAX,EAAD,CAAR,CACH,CAHD,EAIH,CAEC;AAEA,QAASC,CAAAA,gBAAT,CAA0B9B,IAA1B,CAAgC,CAC9B;AACA,GAAM+B,CAAAA,MAAM,CAAG/B,IAAI,CAACgC,KAAL,GAAe5D,WAAW,CAACoD,GAA1C,CAEA;AACAtF,GAAG,CAAC+F,UAAJ,CAAejC,IAAI,CAACwB,GAApB,CAAyBO,MAAzB,EACC1C,IADD,CACM,UAAM,CACVtB,QAAQ,CAAC,SAAC4D,KAAD,QAAWA,CAAAA,KAAK,CAACO,MAAN,CAAa,SAACL,CAAD,QAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUxB,IAAI,CAACwB,GAAtB,EAAb,CAAX,EAAD,CAAR,CACD,CAHD,EAID,CAED;AAEA,QAASW,CAAAA,oBAAT,CAA8BT,OAA9B,CAAuC,CACrCxF,GAAG,CAACkG,UAAJ,CAAeV,OAAO,CAACW,SAAvB,CAAkCX,OAAO,CAACY,QAA1C,EACCjD,IADD,CACM,SAACC,GAAD,CAAS,CACbvB,QAAQ,EAAEuB,GAAF,4BAAUxB,KAAV,GAAR,CACD,CAHD,EAICyB,KAJD,CAIO,SAAAC,GAAG,CAAI,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOAc,cAAc,GACf,CAEH;AAEA,GAAMiC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CAC7B,GAAIzE,KAAK,CAAC0E,MAAN,CAAe,CAAnB,CAAsB,CACpB,MAAO1E,CAAAA,KAAK,CAAC8D,GAAN,CAAU,SAACa,QAAD,qBACd,KAAC,IAAD,EAAyB,IAAI,CAAEA,QAA/B,CAAyC,UAAU,CAAEtB,cAArD,CAAqE,YAAY,CAAEW,gBAAnF,CAAqG,YAAY,CAAE/B,eAAnH,EAAW0C,QAAQ,CAACjB,GAApB,CADc,EAAV,CAAP,CAGD,CACF,CAND,CASF;AAEE,mBACA,KAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEpD,WAApC,uBACE,YAAK,SAAS,CAAC,MAAf,uBACE,aAAK,SAAS,CAAC,YAAf,wBACA,KAAC,MAAD,EACA,OAAO,CAAEuC,YADT,CAEA,KAAK,CAAEzC,KAFP,EADA,cAIE,MAAC,MAAD,yBACE,KAAC,KAAD,EAAO,IAAI,CAAC,UAAZ,CAAuB,OAAO,cAAE,KAAC,KAAD,EAC9B,OAAO,CAAE2C,MADqB,EAAhC,EADF,cAGE,KAAC,KAAD,EAAO,IAAI,CAAC,UAAZ,CAAuB,OAAO,cAAE,KAAC,QAAD,EAC9B,KAAK,CAAE7C,QADuB,CAE9B,UAAU,CAAEgD,cAFkB,EAAhC,EAHF,cAME,KAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,CAAgB,OAAO,cACrB,KAAC,cAAD,EACE,QAAQ,CAAEhD,QADZ,CAEE,SAAS,cACT,KAAC,IAAD,EACA,KAAK,CAAEuE,gBAAgB,EADvB,CAEA,YAAY,CAAE3C,qBAFd,CAGA,aAAa,CAAEC,sBAHf,CAIA,UAAU,CAAEC,mBAJZ,EAHF,EADF,EANF,GAJF,cAsBE,KAAC,MAAD,IAtBF,cAuBE,KAAC,gBAAD,EAAkB,MAAM,CAAE5C,sBAA1B,CAAkD,OAAO,CAAEoD,cAA3D,CAA2E,YAAY,CAAEL,gBAAzF,EAvBF,cAwBE,KAAC,eAAD,EAAiB,MAAM,CAAE7C,qBAAzB,CAAgD,OAAO,CAAEkD,cAAzD,CAAyE,cAAc,CAAEC,kBAAzF,EAxBF,cAyBE,KAAC,aAAD,EAAe,MAAM,CAAEjD,mBAAvB,CAA4C,OAAO,CAAEgD,cAArD,CAAqE,UAAU,CAAE6B,oBAAjF,EAzBF,cA0BE,KAAC,UAAD,EACE,OAAO,CAAE7B,cADX,CAEE,IAAI,CAAE1C,YAFR,EA1BF,cA6BE,KAAC,WAAD,EAAa,MAAM,CAAEF,iBAArB,CAAwC,OAAO,CAAE4C,cAAjD,EA7BF,GADF,EADF,EADA,CAqCD,CAED,cAAetD,CAAAA,GAAf","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport {Header} from './Header.js';\r\nimport {Main} from './Main.js';\r\nimport {Footer} from './Footer.js';\r\nimport {ImagePopup} from './ImagePopup.js';\r\nimport {api} from \"../utils/Api.js\";\r\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\r\nimport { EditProfilePopup } from './EditProfilePopup.js';\r\nimport { EditAvatarPopup } from './EditAvatarPopup.js';\r\nimport { AddPlacePopup } from './AddPlacePopup.js';\r\nimport {Card} from \"./Card.js\";\r\nimport { Login } from \"./Login.js\";\r\nimport { Register } from \"./Register.js\";\r\nimport { InfoToolTip } from \"./InfoToolTip\";\r\nimport { Routes, Route, useNavigate } from \"react-router-dom\";\r\nimport {ProtectedRoute} from \"./ProtectedRoute.js\"\r\nimport { authApi } from '../utils/authApi.js';\r\n\r\nfunction App() {\r\n\r\nconst navigate = useNavigate();\r\n\r\n// стейт перменные попапов\r\n  \r\nconst [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\r\nconst [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\r\nconst [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\r\nconst [isInfoToolTipOpen, setInfoToolTipOpen] = useState({opened: false, status: false});\r\nconst [selectedCard, setSelectedCard] = useState(null);\r\n\r\n// стейт карточек\r\n\r\nconst [cards, setCards] = useState([]);\r\n\r\n// стейт логина\r\n\r\nconst [loggedIn, setLoggedIn] = useState(false)\r\n\r\n// стейт почты пользователя\r\nconst [email, setEmail] = useState('');\r\n\r\n// стейт с данными пользователя \r\n\r\nconst [currentUser, setCurrentUser] = useState({})\r\n\r\n// функция создания куки\r\nconst createCookieInHour = (cookieName, cookieValue, hourToExpire) => {\r\n  let date = new Date();\r\n  date.setTime(date.getTime()+(hourToExpire*60*60*1000));\r\n  document.cookie = cookieName + \" = \" + cookieValue + \"; expires = \" +date.toGMTString();\r\n};\r\n\r\n// проверка на наличие токена в хранилище браузера\r\nuseEffect(() => {\r\n    const token = localStorage.getItem(\"jwt\")\r\n    createCookieInHour('jwt', token, 168);\r\n    if(token) {\r\n      authApi.tokenCheck(token)\r\n      .then((res) => {\r\n        setLoggedIn(true)\r\n      })\r\n      .catch((err) => {\r\n        console.log(authApi.tokenCheck(token));\r\n        console.log(err)\r\n      })\r\n    }\r\n}, [])\r\n\r\n\r\n// установка данных текущего пользователя \r\nuseEffect(() => {\r\n  if(loggedIn) {\r\n    api.getUserInfo()\r\n    .then(res => {\r\n      setCurrentUser(res)\r\n    })\r\n    .catch(err => {\r\n      console.log(err);\r\n    })\r\n  }\r\n},[loggedIn])\r\n\r\n// обработчики открытия попапов\r\n\r\nconst handleEditAvatarClick = () => {\r\n  setEditAvatarPopupOpen(true);\r\n}\r\n\r\nconst handleEditProfileClick = () => {\r\n  setEditProfilePopupOpen(true);\r\n}\r\n\r\nconst handleAddPlaceClick = () => {\r\n  setAddPlacePopupOpen(true);\r\n}\r\n\r\nconst handleCardClick  = (card) => {\r\n  setSelectedCard(card);\r\n}\r\n\r\n// хендлеры обновления данных пользователя \r\n\r\n const handleUpdateUser = (user) => {\r\n  api.editInfo(user.name, user.about)\r\n  .then(res => {\r\n    setCurrentUser(res)\r\n  })\r\n  .catch(err => {\r\n    console.log(err)\r\n  })\r\n  closeAllPopups();\r\n }\r\n\r\n const handleUpdateAvatar = (input) => {\r\n    api.changeAvatar(input.avatar)\r\n    .then(res => {\r\n      setCurrentUser(res)\r\n    })\r\n    .catch(err => {\r\n      console.log(err)\r\n    })\r\n    closeAllPopups();\r\n } \r\n\r\n // хэндлер выхода из профиля\r\n\r\n const handleLogOut = () => {\r\n  localStorage.removeItem(\"jwt\");\r\n  setLoggedIn(false);\r\n  navigate('/sign-in');\r\n }\r\n\r\n // реализация логина + сохранение токена\r\n  const signIn = (input) => {\r\n    authApi.signIn(input.email, input.password)\r\n    .then((res) => {\r\n      localStorage.setItem(\"jwt\", res.token);\r\n      setEmail(input.email);\r\n      setLoggedIn(true);\r\n      navigate('/');\r\n    })\r\n    .catch((err) => {\r\n      console.log(err);\r\n      setInfoToolTipOpen({opened: true, status: false});\r\n    })\r\n  }\r\n\r\n  // передача данных для рпегистрации\r\n  const handleRegister = (input) => {\r\n    authApi.signUp(input.email, input.password)\r\n    .then((res) => {\r\n      setInfoToolTipOpen({opened: true, status: true});\r\n      navigate('/sign-in');\r\n    })\r\n    .catch((err) => {\r\n      setInfoToolTipOpen({opened: true, status: false});\r\n    })\r\n  }\r\n\r\n// закрытие всех попапов\r\n\r\nconst closeAllPopups = () => {\r\n    setEditAvatarPopupOpen(false);\r\n    setEditProfilePopupOpen(false);\r\n    setAddPlacePopupOpen(false);\r\n    setSelectedCard(null);\r\n    setInfoToolTipOpen({opened: false, status: isInfoToolTipOpen.status});\r\n}\r\n\r\n  // загрузка карточек\r\n\r\n  useEffect(() => {\r\n    if(loggedIn) {\r\n      api.getCards()\r\n      .then(res => {\r\n        setCards(res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err)\r\n      })\r\n    }\r\n  }, [loggedIn])\r\n\r\n    // функция лайка карточки\r\n\r\n    function handleCardLike(card) {\r\n      // Снова проверяем, есть ли уже лайк на этой карточке\r\n      const isLiked = card.likes.some(i => i === currentUser._id);\r\n      \r\n      // Отправляем запрос в API и получаем обновлённые данные карточки\r\n      api.changeLikeCardStatus(card._id, isLiked)\r\n      .then((newCard) => {\r\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n      });\r\n  }  \r\n\r\n    // функция удаления карточки\r\n\r\n    function handleCardDelete(card) {\r\n      // проверяем являемся ли мы владельцем карточки\r\n      const isMine = card.owner === currentUser._id;\r\n  \r\n      // отправляем запрос на удаление карточки\r\n      api.deleteCard(card._id, isMine)\r\n      .then(() => {\r\n        setCards((state) => state.filter((c) => c._id !== card._id));\r\n      })\r\n    }\r\n\r\n    // функция добавления карточки\r\n\r\n    function handleAddPlaceSubmit(newCard) {\r\n      api.uploadCard(newCard.placeName, newCard.placeUrl)\r\n      .then((res) => {\r\n        setCards([res, ...cards]);\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      })\r\n      closeAllPopups();\r\n    }\r\n\r\n  // обработка массива с карточками\r\n\r\n  const sectionWithCards = () => {\r\n    if (cards.length > 0) {\r\n      return cards.map((cardInfo) => (\r\n         <Card key={cardInfo._id} card={cardInfo} onCardLike={handleCardLike} onCardDelete={handleCardDelete} selectedCard={handleCardClick} />\r\n      ));\r\n    }\r\n  };\r\n\r\n\r\n// вся разметка сайта\r\n\r\n  return (\r\n  <CurrentUserContext.Provider value={currentUser}>\r\n    <div className=\"page\">\r\n      <div className=\"page__size\">\r\n      <Header\r\n      onCLick={handleLogOut}\r\n      email={email} />\r\n        <Routes>\r\n          <Route path=\"/sign-in\" element={<Login\r\n            onLogin={signIn}/>} />\r\n          <Route path=\"/sign-up\" element={<Register\r\n            login={loggedIn}\r\n            onRegister={handleRegister}/>} />\r\n          <Route path=\"/\" element={\r\n            <ProtectedRoute\r\n              loggedIn={loggedIn}\r\n              component={\r\n              <Main\r\n              cards={sectionWithCards()}\r\n              onEditAvatar={handleEditAvatarClick}\r\n              onEditProfile={handleEditProfileClick}\r\n              onAddPlace={handleAddPlaceClick} />}\r\n            />} \r\n          />\r\n        </Routes>\r\n        <Footer />\r\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} />\r\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} />\r\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} />\r\n        <ImagePopup\r\n          onClose={closeAllPopups}\r\n          card={selectedCard} />\r\n        <InfoToolTip isOpen={isInfoToolTipOpen} onClose={closeAllPopups} />\r\n    </div>\r\n  </div>\r\n</CurrentUserContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}